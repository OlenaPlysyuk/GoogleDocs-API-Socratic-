<!DOCTYPE html>
<html>
<head>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
    }
    #chat {
      flex: 1;
      padding: 8px;
      overflow-y: auto;
      background-color: #f9f9f9;
    }
    .message.user {
      color: #333;
      margin: 8px 0;
      text-align: right;
    }
    .message.assistant {
      color: #555;
      margin: 8px 0;
      text-align: left;
    }
    #inputContainer {
      display: flex;
      border-top: 1px solid #ccc;
      padding: 8px;
      background-color: #fff;
    }
    #prompt {
      flex: 1;
      resize: none;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      height: 48px;
    }
    #send {
      margin-left: 8px;
      padding: 0 16px;
      font-size: 14px;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #send:hover {
      background-color: #45A049;
    }
  </style>
</head>
<body>
  <div id="chat"></div>
  <div id="inputContainer">
    <textarea id="prompt" placeholder="Enter your prompt..." rows="2"></textarea>
    <button id="send">Send</button>
  </div>
  <script>
    const chatEl = document.getElementById('chat');
    const promptEl = document.getElementById('prompt');
    const sendBtn = document.getElementById('send');

    function appendMessage(role, content) {
      const msg = document.createElement('div');
      msg.className = 'message ' + role;
      msg.textContent = (role === 'user' ? 'You: ' : 'Assistant: ') + content;
      chatEl.appendChild(msg);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function send() {
      const text = promptEl.value.trim();
      if (!text) return;
      appendMessage('user', text);
      promptEl.value = '';
      google.script.run.withSuccessHandler(res => {
        appendMessage('assistant', res);
      }).processPromptShow(text);
    }

    sendBtn.addEventListener('click', send);
    promptEl.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    function loadHistory() {
      google.script.run.withSuccessHandler(hist => {
        hist.forEach(entry => appendMessage(entry.role, entry.content));
      }).getChatHistory();
    }

    window.addEventListener('load', loadHistory);
  </script>
</body>
</html>
